<html>

  <head>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css"/>
    <link rel="stylesheet" href="../style.css"/>

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="map.js"></script>
    <link rel="points" type="application/json" href="./test.geojson">

  </head>


  <title>
    TEST
  </title>

  <head>
    TEST GIT PAGE<br><br>
    

    <div id="markerslist">
      <table></table>
    </div>
    <div id="map" style="height:80%;width:100%"></div>
    
    <script>
      var map;
      initmap();
/*
      var loc1 = new L.LatLng(45.524, -122.675);
      var center1 = new L.LatLng(45.57, -122.675);
      var loc2 = new L.LatLng(45.524, -123);
      var center2 = new L.LatLng(45.57, -123);

      var popup1 = "<img src=https://dl.dropbox.com/sh/at3xqoei1wbc0ui/eWY3LGBx2J/5th_avenue.jpg/>";
      var popup2 = "<img src=https://dl.dropbox.com/sh/at3xqoei1wbc0ui/zoLjbs5d7I/hatfield.jpg/>";


      var one = new L.marker(loc1, {icon: new L.NumberedDivIcon({number: '1'})})
        .bindPopup(popup1, {minWidth:330, minHeight:247})
        .addTo(map);

      one.on('click', function(e) {
        map.panTo(center1)
      });

      var two = new L.marker(loc2, {icon: new L.NumberedDivIcon({number: '2'})})
        .bindPopup(popup2, {minWidth:400, minHeight:260})
        .addTo(map);

      two.on('click', function(e) {
        map.panTo(center2)
      });

      function onEachFeature(feature, layer) {
        if (feature.properties) {
          layer.bindPopup(feature.properties.name);
        }
          layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: zoomToFeature
        });
      } 
*/

      function clickMarker(e) {
        var lat = e.latlng.lat + 0.03;
        var lng = e.latlng.lng;
        map.panTo({lat:lat, lng:lng});
      }
      

      function onEachFeature(feature, layer) {
        //does this feature have a property named popupContent?
        layer.bindPopup(feature.properties.popupContent, {
          minWidth: feature.properties.minWidth, 
          minHeight: feature.properties.minHeight,
        });
        layer.on({click: clickMarker});
      }
    
    var link = $('<a href="#" class="speciallink">TestLink</a>').click(function() {
       alert("test");
    })[0];


    var test_marker = new L.marker(new L.LatLng(45.50, -122.675),{icon: new L.NumberedDivIcon({number: '3'})})
        .bindPopup(link)
        .addTo(map);


      $.getJSON($('link[rel="points"]').attr("href"), function(data) {
        var geojson = L.geoJson(data, {
          onEachFeature: onEachFeature,
          pointToLayer: function (feature, latlng) {
             return new L.marker(latlng, {
               icon: new L.NumberedDivIcon({number: feature.properties.number}), 
             });
          }

        });
        
        geojson.eachLayer( function (layer) {
          var id = layer._leaflet_id;
          var name = layer.feature.properties.name;
  
         $( "#markerslist table" ).append('<tr><td><a href="#" onclick="map._layers['+id+'].openPopup();">'+name+'</a></td></tr>');

        });

        geojson.addTo(map);

    }); 




    </script>
  </head>

</html>
